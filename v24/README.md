# Voron 2.4 300mm build

[Board](https://github.com/FYSETC/FYSETC-SPIDER)

* Carbon filter: Nevermore - yes - configure needs to be done and also needs reprinting as the cover has warped and is no longer air tight.
* GE5C bearing mod - yes - https://github.com/hartk1213/MISC/tree/main/Voron%20Mods/Voron%202/2.4/Voron2.4_GE5C
* Pins mod for MGN12 -  yes
* Stealthburner and CW2
* Phaetus Dragon with Zodiac Coated nozzle
* SB2040 CanBus v1 from Mellow
* Mellow Fly-UtoC-1 - Does not require a R120 jumper. Yellow is H and White is L. 
* Voron Tap - for z nozzle probe
* RGB Chamber Lights from oc_geek
* Bed Wagos from deepfriedhero.in https://github.com/VoronDesign/VoronUsers/tree/master/printer_mods/deepfriedheroin/v2_bed_wagos
* https://www.thingiverse.com/thing:4817974 or https://www.thingiverse.com/thing:4828117 or https://github.com/Ramalama2/Voron-2-Mods/tree/main/Wagomount_221
* Klipper Expander for Neopixels for the Stealthburner - installed - needs flashing and new [mcu expander](https://github.com/VoronDesign/Voron-Hardware/tree/master/Klipper_Expander/Documentation) section.
* Ramalama2 front-idlers
* https://github.com/VoronDesign/VoronUsers/tree/master/printer_mods/edwardyeeks/Decontaminator_Purge_Bucket_%26_Nozzle_Scrubber
* https://github.com/nevermore3d/Nevermore_Micro
* https://github.com/tanaes/whopping_Voron_mods/tree/main/extrusion_backers
* 3010 fan mod for electronics cover for SB204 on CW2 - to be added

Interesting research projects

* https://github.com/alchemyEngine/measure_thermal_behavior/blob/main/process_frame_expansion.py
* Adaptive meshing 

CW2:
* DELTA BFB0524HH BLOWER FAN - 5015 blower for part cooling
* NMB 4010 SS-24N-AT-00 

Wiring: https://cdn.discordapp.com/attachments/624317225540780055/928014037734801408/20220104_191958.jpg


https://github.com/AndrewEllis93/Ellis-PIF-Profile
https://github.com/AndrewEllis93/Print-Tuning-Guide

Coverted to CANBus when installing StealthBurner and Voron Tap

- configure and flash [canboot](https://github.com/Arksine/CanBoot) to the SB2040 - [instructions](https://github.com/cruiten/Voron-Related/blob/main/CANbus/Documentation/SB2040_CAN/install_configure_canboot.md)
- now we need a 16kb offset in klipper for the SB2040 - to allow flashing via klipper in the future
- then flash klipper to the SB2040

i.e. the SB2040 - needs CanBoot to allow klipper to flash remotely. Then we install klipper in the program space of the device.

Jumpers for sensorless homing installed on the X and Y drivers. -  trigger positions to be tested and set




https://www.klipper3d.org/CANBUS.html
https://github.com/cruiten/Voron-Related/blob/main/CANbus/Documentation

## Commissioning

* Hotend thermistor wires don't like staying in their crimps on the toolhead board. Maybe the SB board with the Molex connector will be better?
* Add jumpers to M3-2 to disable to dual-Z and to enable `STEPPER_BUZZ stepper=stepper_z` to actually work.
* Move the X and Y endstop from (-) to (+)
* Hall Effect sensor board - Y works, X LED stays lit and goes off when triggered - seems inverted logic. Will swap out board and retest once the cables are moved.
* Bed temp thermistor wires might have broken off - not getting any readings and MCU shutdown error. Disabled config.
* Homing X caused the gantry to move down - need to verify what this is - very confusing - used the kill switch on the LCD (checked before issuing the homing command). 
* Terrible metal on metal squeak was the Z accent covers that were running on the pulleys - added little plastic spacers and longer screws
* The SSR was not coming on and heating the bed. You need to supply 24v to the BED_IN terminals on the board. Created jumper wires from the 24V in wires to brodge to the BED_IN and that sorted it out.

### PID Calibrate

Set fan to 40% and calibrate the heater for the hot end.

```gcode
M106 S102
PID_CALIBRATE heater=extruder TARGET=240
SAVE_CONFIG
```
Extruder settings:
```shell
pid_Kp=24.058 pid_Ki=1.471 pid_Kd=98.339
```
Why is the hotend fan not running.... I had the wires swapped - easy fix.

### raspberry pi

* enable SPI
* enable Serial 

Edit `/boot/config.txt` and disable the BT stack to run the GPIO between the spider and the pi.
See the [rpi config](config.txt) for details - just replace the file and reboot.
 
#### change locale

Set en_GB.UTF-8 in localisation `sudo raspi-config` and then update the locale defaults file too.

```shell
cat /etc/defaults/locale
#  File generated by update-locale
LANG=en_GB.UTF-8
LANGUAGE=en_GB.UTF-8
LC_ALL=en_GB.UTF-8
```

#### aliases

Copy the .bash_aliases

#### compile and update klipper

Initial setup. Configure the klipper.config file with the correct parameters.

```shell
mkdir ~/bin
cd ~/bin
ln -sf ~/klipper_config/update-mcu
```

Updating the firmware

```shell
update-mcu
```

The following error is expected - as the rpi is connected internally via uart and the USB port is not used for connection. Need to manually copy the out/klipper.bin to FIRMWARE.BIN on an SDCard.

```shell
SPIFlashError: Failed to Initialize SD Card. Is it inserted?
```


Upload the FIRMWARE.BIN to an SDCARD and insert into the board. Press the Reset button once, maybe twice. Check the status lights - fast blinking, then slow blinking and then off.

Remove the SDCARD and confirm the filename has changed to OLD.BIN

Do a FIRMWARE_RESTART in the browser and the board should now be recognised and the thermistors should be active.


###

Good tips for the Voron from Kapman's Basement Workshop on (YT){https://www.youtube.com/watch?v=-DcdVez_v5Q}

### Input Shaper

`SHAPER_CALIBRATE` is a short-cut for X and Y TEST_RESONANCE and can SAVE_CONFIG the calculated values.

```console
0:12:25 
// Calculating the best input shaper parameters for x axis
20:12:28 
// Fitted shaper 'zv' frequency = 49.6 Hz (vibrations = 5.2%, smoothing ~= 0.069)
20:12:28 
// To avoid too much smoothing with 'zv', suggested max_accel <= 9600 mm/sec^2
20:12:32 
// Fitted shaper 'mzv' frequency = 48.4 Hz (vibrations = 1.3%, smoothing ~= 0.087)
20:12:32 
// To avoid too much smoothing with 'mzv', suggested max_accel <= 6900 mm/sec^2
20:12:35 
// Fitted shaper 'ei' frequency = 54.4 Hz (vibrations = 0.0%, smoothing ~= 0.109)
20:12:35 
// To avoid too much smoothing with 'ei', suggested max_accel <= 5500 mm/sec^2
20:12:38 
// Fitted shaper '2hump_ei' frequency = 59.0 Hz (vibrations = 0.0%, smoothing ~= 0.155)
20:12:38 
// To avoid too much smoothing with '2hump_ei', suggested max_accel <= 3900 mm/sec^2
20:12:42 
// Fitted shaper '3hump_ei' frequency = 86.6 Hz (vibrations = 0.0%, smoothing ~= 0.109)
20:12:42 
// To avoid too much smoothing with '3hump_ei', suggested max_accel <= 5500 mm/sec^2
20:12:42 
// Recommended shaper_type_x = mzv, shaper_freq_x = 48.4 Hz
20:12:42 
// Shaper calibration data written to /tmp/calibration_data_x_20220611_200739.csv file
20:12:42 
// Calculating the best input shaper parameters for y axis
20:12:45 
// Fitted shaper 'zv' frequency = 59.8 Hz (vibrations = 31.2%, smoothing ~= 0.050)
20:12:45 
// To avoid too much smoothing with 'zv', suggested max_accel <= 13900 mm/sec^2
20:12:48 
// Fitted shaper 'mzv' frequency = 37.2 Hz (vibrations = 5.8%, smoothing ~= 0.147)
20:12:49 
// To avoid too much smoothing with 'mzv', suggested max_accel <= 4100 mm/sec^2
20:12:52 
// Fitted shaper 'ei' frequency = 50.6 Hz (vibrations = 8.3%, smoothing ~= 0.126)
20:12:52 
// To avoid too much smoothing with 'ei', suggested max_accel <= 4800 mm/sec^2
20:12:55 
// Fitted shaper '2hump_ei' frequency = 46.8 Hz (vibrations = 0.8%, smoothing ~= 0.246)
20:12:55 
// To avoid too much smoothing with '2hump_ei', suggested max_accel <= 2400 mm/sec^2
20:12:59 
// Fitted shaper '3hump_ei' frequency = 51.8 Hz (vibrations = 0.0%, smoothing ~= 0.305)
20:12:59 
// To avoid too much smoothing with '3hump_ei', suggested max_accel <= 1800 mm/sec^2
20:12:59 
// Recommended shaper_type_y = 2hump_ei, shaper_freq_y = 46.8 Hz
20:12:59 
// Shaper calibration data written to /tmp/calibration_data_y_20220611_200739.csv file
20:12:59 
// The SAVE_CONFIG command will update the printer config file
// with these parameters and restart the printer.
```

Saved values.

```console
[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 48.4
shaper_type_y = 2hump_ei
shaper_freq_y = 46.8
```

[x axis](shaper_calibration_x_20220611_200739.png)
[y axis](shaper_calibration_y_20220611_200739.png)

