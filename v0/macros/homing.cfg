[force_move]
enable_force_move: True

[homing_override]
axes: xyz
gcode:
    {% set HOME_X, HOME_Y, HOME_Z = False, False, False %}

    {% if not 'X' in params and not 'Y' in params and not 'Z' in params %}
        {% set HOME_X, HOME_Y, HOME_Z = True, True, True %}
    {% else %}
        {% if 'X' in params %}
            {% set HOME_X = True %}
        {% endif %}
        {% if 'Y' in params %}
            {% if not 'x' in printer.toolhead.homed_axes %}
                {% set HOME_X = True %}
            {% endif %}
            {% set HOME_Y = True %}
        {% endif %}
        {% if 'Z' in params %}
            {% if not 'x' in printer.toolhead.homed_axes %}
                {% set HOME_X = True %}
            {% endif %}
            {% if not 'y' in printer.toolhead.homed_axes %}
                {% set HOME_Y = True %}
            {% endif %}
            {% set HOME_Z = True %}
        {% endif %}
    {% endif %}

    {% if 'y' not in printer.toolhead.homed_axes %}
        SET_KINEMATIC_POSITION Y={printer.configfile.config.stepper_y.position_max}
        {% set HOME_X, HOME_Y, HOME_Z = True, True, True %}
    {% endif %}

    {% if 'z' not in printer.toolhead.homed_axes %}
        SET_KINEMATIC_POSITION Z=0
        {% set HOME_X, HOME_Y, HOME_Z = True, True, True %}
    {% endif %}

    {% if HOME_X %}HOME_X{% endif %}
    {% if HOME_Y %}HOME_Y{% endif %}
    {% if HOME_Z %}HOME_Z{% endif %}

[gcode_macro HOME_X]
gcode:
    {% if printer.toolhead.position.z < 10 %}
        G90
        G0 Z{printer.configfile.config.probe.z_offset|float + 5} F{printer.configfile.config.stepper_z.homing_speed|float*60}
    {% endif %}
    {% if printer.toolhead.position.y > 110 %}
        G90
        G0 Y110 F{printer.configfile.config.stepper_y.homing_speed|float*60}
    {% endif %}
    G28 X

[gcode_macro HOME_Y]
gcode:
    {% if printer.toolhead.position.z < 10 %}
        G90
        G0 Z{printer.configfile.config.probe.z_offset|float + 5} F{printer.configfile.config.stepper_z.homing_speed|float*60}
    {% endif %}
    G90
    G0 X70 F{150*60}
    G28 Y
    G0 Y100 F{150*60}

[gcode_macro HOME_Z]
gcode:
  ATTACH_PROBE
  HOME_Z_WITH_PROBE
  DETACH_PROBE
